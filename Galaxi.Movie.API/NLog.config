<?xml version="1.0" encoding="utf-8" ?>
<nlog	xmlns="http://www.nlog-project.org/schemas/NLog.xsd"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://www.nlog-project.org/schemas/NLog.xsd NLog.xsd"
		autoReload="true"
		throwExceptions="false"
		internalLogLevel="Debug" internalLogFile="C:\temp\nlog-internal-movie.log"
		>

	<extensions>
		<add assembly="NLog.Targets.ElasticSearch"/>
		<add assembly="NLog.Web.AspNetCore"/>
	</extensions>
	
	<targets>

		<target	name="elastic"
				xsi:type="ElasticSearch"
				uri="http://localhost:9200"
				index="logs-movie"
				documentType=""
				includeAllProperties="true"
				disableCertificateValidation="true"
				>
			<layout xsi:type="JsonLayout">
				<attribute name="time" layout="${longdate}" />
				<attribute name="level" layout="${level:upperCase=true}"/>
				<attribute name="callsite" layout="${callsite}" />
				<attribute name="RequestId" layout="${mdlc:item=RequestId}" />
				<attribute name="Duration" layout="${event-properties:item=Duration}ms" />
				<attribute name="UserAgent" layout="${aspnet-request-header:User-Agent}" />
				<attribute name="IP" layout="${aspnet-request-ip}" />
				<attribute name="exception" layout="${exception:format=tostring}" />
				<attribute name="message" layout="${message}" />
			</layout>
		</target>

		<target name="logfile"
				xsi:type="File"
				archiveEvery="Day"
				archiveNumbering="Rolling"
				maxArchiveFiles="2"
				fileName="C:/samba/logs/logs-movie-${shortdate}.json"
				>
			<layout xsi:type="JsonLayout">
				<attribute name="time" layout="${longdate}" />
				<attribute name="level" layout="${level:upperCase=true}"/>
				<attribute name="callsite" layout="${callsite}" />
				<attribute name="RequestId" layout="${mdlc:item=RequestId}" />
				<attribute name="Duration" layout="${event-properties:item=Duration}ms" />
				<attribute name="UserAgent" layout="${aspnet-request-header:User-Agent}" />
				<attribute name="IP" layout="${aspnet-request-ip}" />
				<attribute name="exception" layout="${exception:format=tostring}" />
				<attribute name="message" layout="${message}" />
			</layout>
		</target>

		<target name="errorlogfile"
				xsi:type="File"
				archiveEvery="Day"
				fileName="C:/samba/logs/optaCalc_ErrorLog-${shortdate}.txt"
				layout="${longdate}|${level:uppercase=true}|${logger}|${message}${newline}  ${exception:format=toString:innerExceptionSeparator=\r\n\t}" />
	</targets>
	<rules>
		<logger name="Microsoft.AspNetCore.*" minlevel="Error" writeTo="errorlogfile" />

		<logger name="Galaxi.Movie.API.*" minlevel="Trace" writeTo="logfile,elastic" />
	</rules>
</nlog>